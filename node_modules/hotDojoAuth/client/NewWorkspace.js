define([

  "dojo/_base/declare"

, "dijit/layout/ContentPane"
, "dijit/form/Form"
, "dijit/form/TextBox"
, "dijit/_WidgetBase"
, "dijit/_TemplatedMixin"
, "dijit/_WidgetsInTemplateMixin"

, "hotplate/hotDojoSubmit/defaultSubmit"
, "hotplate/hotDojoStores/stores"
, "hotplate/hotDojoWidgets/AlertBar"
, "hotplate/hotDojoWidgets/BusyButton"
, "hotplate/hotDojoAuth/ValidationWorkspace"
, "dojo/text!hotplate/hotDojoAuth/templates/NewWorkspace.html"

, "hotplate/hotDojoAuth/ValidationWorkspace"

, "hotplate/hotDojoWidgets/_TemplatedHooksMixin"

], function(

  declare

, ContentPane
, Form
, TextBox
, _WidgetBase
, _TemplatedMixin
, _WidgetsInTemplateMixin

, ds
, stores
, AlertBar
, BusyButton
, ValidationWorkspace
, templateString

, ValidationWorkspace

, _TemplatedHooksMixin

){

  return declare( [_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin, _TemplatedHooksMixin ], {

    widgetsInTemplate: true,

    templateString: templateString,
      
    postCreate: function(){
      var self = this;

      this.inherited( arguments );

      this.formWidget.onSubmit = ds.defaultSubmit(this.formWidget, this.buttonWidget, function(){
        var data = self.formWidget.getValues();

        stores('workspaces', {} ).noCache.put( data ).then(
          ds.UIMsg( self.buttonWidget, self.alertBarWidget , "Workspace created!" ),
          ds.UIErrorMsg( self.formWidget, self.buttonWidget, self.alertBarWidget, true )
        ).then(
          function(res){
            window.location = vars.hotCoreMultiHome.multiHomeURL.replace( ':workspaceId', res.id );
          }
        );
      });
    },

  });
});

